name: Daily Quote Rotation

on:
  schedule:
    - cron: "0 0 * * *"   # runs daily at 00:00 UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  rotate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate daily quote RSS
        run: |
          node <<'EOF'
          const fs = require('fs');

          const data = JSON.parse(fs.readFileSync('quotes.json', 'utf8'));
          const quote = data.quotes[data.index];

          const xml = `<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
  <channel>
    <title>Quote of the Day</title>
    <description>Daily mindset and motivation quote</description>
    <link>https://pradohood.github.io/quote-feed/</link>

    <item>
      <title>${quote.text.replace(/&/g,"&amp;").replace(/</g,"&lt;")}</title>
      <description>â€” ${quote.author}</description>
    </item>

  </channel>
</rss>`;

          fs.writeFileSync('quotes.xml', xml);

          data.index = (data.index + 1) % data.quotes.length;
          fs.writeFileSync('quotes.json', JSON.stringify(data, null, 2));
          EOF

      - name: Commit changes
        run: |
          git config user.name "quote-bot"
          git config user.email "quote-bot@users.noreply.github.com"
          git add quotes.xml quotes.json
          git commit -m "Daily quote update" || exit 0
          git push
